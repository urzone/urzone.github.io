<!DOCTYPE html>
<html lang="cmn-Hans-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>分子动力学模拟蛋白与小分子相互作用 - XiaO | 缄默之语</title>
    <meta property="og:title" content="分子动力学模拟蛋白与小分子相互作用 - XiaO | 缄默之语">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="AMBER 是辅助模型构建和能量精化 (Assisted Model Building and Energy Refinement) 的首字母缩写, 它既指代分子动力学程序，也指代一组描述了生物分子相互作用的势能函数和参数的力场。
[&amp;hellip;] conda create --name AmberTools22 # 新建虚拟环境 conda activate AmberTools22 # 激 &amp;hellip;">
      <meta property="og:description" content="AMBER 是辅助模型构建和能量精化 (Assisted Model Building and Energy Refinement) 的首字母缩写, 它既指代分子动力学程序，也指代一组描述了生物分子相互作用的势能函数和参数的力场。
[&amp;hellip;] conda create --name AmberTools22 # 新建虚拟环境 conda activate AmberTools22 # 激 &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="https://urz.one/images/logo.png">
    
    

    

    
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    



<link rel="stylesheet" href="/css/custom.css" />


<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
<link rel="manifest" href="/images/icons/manifest.json">
<link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#cc342c">
<link rel="shortcut icon" href="/images/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="XiaO">
<meta name="application-name" content="XiaO">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-TileImage" content="/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="3C4lz-WqreDsFFohPRed1rO14aKeEDmTbw2lfIHN6og" />
  </head>

  
  <body class="cn">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.svg" alt="XiaO" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/cn/note/">缄语</a></li>
  
  <li><a href="/en/">En</a></li>
  
  

<li class="menu-extra"></li>


<li><a href="/cn/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>分子动力学模拟蛋白与小分子相互作用</h1>


<h3>XiaO / 
2022-08-09</h3>

<hr>


      </header>



<h3 id="介绍">介绍</h3>
<p>AMBER 是辅助模型构建和能量精化 (Assisted Model Building and Energy Refinement) 的首字母缩写, 它既指代<strong>分子动力学程序</strong>，也指代一组<strong>描述了生物分子相互作用的势能函数和参数的力场</strong>。</p>
<h3 id="准备蛋白">准备蛋白</h3>
<ul>
<li><a href="https://www.rcsb.org/">下载</a>蛋白的 pdb 文件
<ul>
<li>1ODX.pdb</li>
</ul>
</li>
<li><a href="http://newbiophysics.cs.vt.edu/H++/select_list.php?choice=none">生成</a> 蛋白的 top 与 crd 文件：
<ul>
<li>0.15_80_10_pH6.5_1ODX.top</li>
<li>0.15_80_10_pH6.5_1ODX.crd</li>
</ul>
</li>
<li>本地安装 AmberTools22，使用  <code>ambpdb</code> 命令合成蛋白的 pdb 文件</li>
</ul>
<pre tabindex="0"><code>conda create --name AmberTools22 # 新建虚拟环境
conda activate AmberTools22 # 激活该虚拟环境
conda install -c conda-forge ambertools=22 compilers # 安装 AmberTools22

# 用上一步生成的 top crd 文件，合成模拟所需的 pdb 文件
ambpdb -p 0.15_80_10_pH6.5_1ODX.top -c 0.15_80_10_pH6.5_1ODX.crd &gt; 0.15_80_10_pH6.5_1ODX.pdb 
</code></pre><h3 id="准备小分子">准备小分子</h3>
<p>从前述下载的蛋白文件 1ODX.pdb 中提取小分子，该文件是一个蛋白与一个小分子的复合文件，也可以使用其它小分子。</p>
<ul>
<li>文本编辑器打开 pdb 文件，搜索 <code>BINDING SITE</code></li>
<li>展示文件中的分子信息：</li>
</ul>
<pre tabindex="0"><code>pdb4amber -i 1ODX.pdb -o 1ODX_clean.pdb # 可对文件标准化处理 (clean)
</code></pre><pre tabindex="0"><code>==================================================
Summary of pdb4amber for: /Users/urzone/pdb4amber/1odx.pdb
===================================================
----------Chains
The following (original) chains have been found:
A
B
---------- Alternate Locations (Original Residues!))

The following residues had alternate locations:
None
-----------Non-standard-resnames （小分子文件）
0E8

---------- Missing heavy atom(s)
None
</code></pre><ul>
<li>提取小分子，对小分子还原（加氢）处理，对小分子再次标准化处理：</li>
</ul>
<pre tabindex="0"><code>awk &#39;$4==&#34;0E8&#34;&#39; 1ODX.pdb &gt; ligand1.pdb # 提取 pdb 文件的第四列，即小分子

reduce ligand1.pdb &gt; ligand2.pdb # 还原，即对小分子加氢，即 H
#如果加氢失败，请使用open babel 加氢。
#conda install -c conda-forge openbabel
#obabel -ipdb ligand1.pdb -opdb -O ligand2.pdb -h

pdb4amber -i ligand2.pdb -o ligand3.pdb # 对文件标准化处理，即 clean
</code></pre><ul>
<li>生成 mol2</li>
</ul>
<pre tabindex="0"><code>antechamber -fi pdb -i ligand3.pdb -fo mol2 -o ligand4.mol2 -c bcc -pf y 
# This step may take a little bit of time, upon finish, check &#34;sqm.out&#34;, the last line should be
#            --------- Calculation Completed ----------
</code></pre><ul>
<li>生成 prepi frcmod</li>
</ul>
<pre tabindex="0"><code>antechamber -i ligand4.mol2 -fi mol2 -o ligand5.prepi -fo prepi -pf y

parmchk2 -f prepi -i ligand5.prepi -o ligand6.frcmod
</code></pre><h3 id="合并小分子与蛋白">合并小分子与蛋白</h3>
<p>将前述处理好的小分子 (ligand3.pdb) 与蛋白 (0.15_80_10_pH6.5_1ODX.pdb) 合并为一个文件 (1ODX_H.pdb)，并对复合物文件进行标准化 (1ODX_clean_H.pdb)：</p>
<pre tabindex="0"><code>cat 0.15_80_10_pH6.5_1ODX.pdb ligand3.pdb &gt; 1ODX_H.pdb 

pdb4amber -i 1ODX_H.pdb -o 1ODX_clean_H.pdb
</code></pre><h3 id="生成-prmtop-与-inpcrd">生成 prmtop 与 inpcrd</h3>
<ul>
<li>用前述整理好的包含小分子与蛋白的复合物文件 (1ODX_clean_H.pdb) 生成 prmtop 与 inpcrd 文件，这两个文件是用于在 openmm-setup 中进行 AMBER 模拟的输入文件。
<ul>
<li>prmtop: 描述系统中分子的参数和拓扑</li>
<li>inpcrd: 描述系统初始分子坐标</li>
</ul>
</li>
<li>新建文件 1ODX_tleap.in，输入如下内容：</li>
</ul>
<pre tabindex="0"><code>source leaprc.protein.ff14SB              #Source leaprc file for ff14SB protein force field
source leaprc.gaff                        #Source leaprc file for gaff
source leaprc.water.tip3p                 #Source leaprc file for TIP3P water model
loadamberprep ligand5.prepi               #Load the prepi file for the ligand
loadamberparams ligand6.frcmod            #Load the additional frcmod file for ligand
mol = loadpdb 1ODX_clean_H.pdb            #Load PDB file for protein-ligand complex
solvatebox mol TIP3PBOX 8                 #Solvate the complex with a cubic water box
addions mol Cl- 0                         #Add Cl- ions to neutralize the system
saveamberparm mol 1ODX.prmtop 1ODX.inpcrd #Save AMBER topology and coordinate files
quit                                      # Quit tleap program
</code></pre><p>在终端运行该文件 1ODX_tleap.in，得到文件 prmtop 与 inpcrd：</p>
<pre tabindex="0"><code>tleap -s -f 1ODX_tleap.in &gt; 1ODX_tleap.out
</code></pre><h3 id="模拟条件设置">模拟条件设置</h3>
<ul>
<li><a href="http://docs.openmm.org/latest/userguide/application/02_running_sims.html">OpenMM 用户手册</a>：<a href="http://docs.openmm.org/latest/userguide/application/05_creating_ffs.html">力场选择</a></li>
<li><a href="https://github.com/openmm/openmmforcefields">OpenMM 额外力场的添加与使用</a></li>
<li><a href="http://ambermd.org/antechamber/gaff.html">适用小分子的 GAFF 力场</a></li>
</ul>
<p>本地安装并启动 openmm-setup</p>
<pre tabindex="0"><code>conda deactivate # deactivate all virtual environments 
conda create -name openmm python=3 # create a virtual environment named openmm based on pyhton 3
conda activate openmm # # activate the openmm virtual environment
conda install -c conda-forge openmm-setup # install openmm 
openmm-setup # run openmm
</code></pre><p>对模拟条件进行设置：</p>
<ul>
<li>选择 Amber 文件，上传 prmtop inpcrd 两个文件</li>
<li>platform 选择：CUDA，如果你的可用平台没有 GPU，则更改 CUDA 为 CPU 即可。</li>
<li>保存脚本<code>Save Script</code>。得到 openmm 模拟所需的脚本 <code>run_openmm_simulation.py</code></li>
</ul>
<h3 id="启用-google-colab-模拟">启用 google colab 模拟</h3>
<p>安装环境：</p>
<pre tabindex="0"><code>#@title  Install Dependencies
! wget https://repo.anaconda.com/miniconda/Miniconda3-py37_4.8.2-Linux-x86_64.sh
! chmod +x Miniconda3-py37_4.8.2-Linux-x86_64.sh
! bash ./Miniconda3-py37_4.8.2-Linux-x86_64.sh -b -f -p /usr/local

import sys
sys.path.append(&#39;/usr/local/lib/python3.7/site-packages/&#39;)
</code></pre><p>安装 OpenMM：</p>
<pre tabindex="0"><code>#@title Install OpenMM
!yes|conda install -c conda-forge openmm
</code></pre><p>测试 OpenMM 并查看可用的平台：</p>
<pre tabindex="0"><code>#@title Verify OpenMM installation and check the available Platforms
!python -m openmm.testInstallation
</code></pre><p>模拟蛋白与分子相互作用：</p>
<pre tabindex="0"><code>复制 run_openmm_simulation.py 中的代码到此处进行模拟即可，注意修改输入文件的位置
</code></pre><p>得到蛋白与小分子相互作用的轨迹文件： trajectory.dcd。</p>
<h3 id="轨迹分析-r-包-bio3dhttpthegrantlaborgbio3darticlesonlineintro_vignettebio3d_introductionhtml"><a href="http://thegrantlab.org/bio3d/articles/online/intro_vignette/Bio3D_introduction.html">轨迹分析: R 包 Bio3D</a></h3>
<p>在终端中使用 brew 安装 r 及 rstudio：</p>
<pre tabindex="0"><code>brew indatll r rstudio
</code></pre><p>打开 rstudio，安装 bio3d：</p>
<pre tabindex="0"><code>install.packages(&#34;bio3d&#34;, dependencies=TRUE)
</code></pre><pre tabindex="0"><code># load package
library(bio3d) 

# load demo
# demo(&#39;pdb&#39;)
# demo(&#34;md&#34;) 

# read data files: dcd and complex.pdb ()
mydcdfile &lt;- &#34;path/to/trajectory.dcd&#34;
mypdbfile &lt;- &#34;path/to/complex.pdb&#34;

# variables
dcd &lt;- read.dcd(mydcdfile)
pdb &lt;- read.pdb(mypdbfile)

# 查看文件信息
print(pdb)
print(dcd)

#  叠合以氨基酸的 Alpha 碳原子为基准，选中阿尔法碳
# Trajectory Frame Superposition on Calpha atoms
ca.inds &lt;- atom.select(pdb, &#34;ligand&#34;)
# http://thegrantlab.org/bio3d_v2/html/atom.select.html
#Input selection criteria include selection string keywords (such as &#34;calpha&#34;, &#34;backbone&#34;, &#34;sidechain&#34;, &#34;protein&#34;, &#34;nucleic&#34;, &#34;ligand&#34;, etc.) and individual named selection components (including ‘chain’, ‘resno’, ‘resid’, ‘elety’ etc.).


# 轨迹叠合
xyz &lt;- fit.xyz(fixed=pdb$xyz, 
               mobile=dcd,
               fixed.inds=ca.inds$xyz,
               mobile.inds=ca.inds$xyz)

# 检查叠合是否完整 &#34;[1] TRUE TRUE&#34; 则无误
dim(xyz) == dim(dcd)


# RMSD 是阿尔法碳原子坐标相对于初始坐标的根平均离散方差，它反映了蛋白阿尔法碳原子在空间上随时间的扰动程度
# 如果 RMSD 不再变化，说明模拟已经达到了一个相对平衡的状态
# 输出 RMSD 曲线图
# Root Mean Square Deviation (RMSD)
rd &lt;- rmsd(xyz[1, ca.inds$xyz], xyz[, ca.inds$xyz])
plot(rd, typ = &#34;l&#34;, ylab = &#34;RMSD&#34;, xlab = &#34;Frame No.&#34;)


points(lowess(rd), typ = &#34;l&#34;, col = &#34;red&#34;, lty = 2, lwd = 2)
summary(rd)

# Root Mean Squared Fluctuations (RMSF)
rf &lt;- rmsf(xyz[, ca.inds$xyz])
plot(rf, ylab = &#34;RMSF&#34;, xlab = &#34;Residue Position&#34;, typ=&#34;l&#34;)

# Principal Component Analysis
pc &lt;- pca.xyz(xyz[, ca.inds$xyz])
plot(pc, col = bwr.colors(nrow(xyz)))

# Cluster in PC space
hc &lt;- hclust(dist(pc$z[, 1:2]))
grps &lt;- cutree(hc, k = 2)
plot(pc, col = grps)

# Cross-Correlation Analysis
cij &lt;- dccm(xyz[, ca.inds$xyz])
plot(cij)

## view.dccm(cij, pdb, launch = TRUE)
</code></pre><h3 id="gafftemplategeneratorhttpsgithubcomopenmmopenmmforcefieldson-the-fly-template-generation-for-small-molecules"><a href="https://github.com/openmm/openmmforcefields#on-the-fly-template-generation-for-small-molecules">GAFFTemplateGenerator</a></h3>
<hr>
<p>参考资料：</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/433646995">如何从零开始做一个蛋白小分子动力学模拟</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/448829436">蛋白 - 小分子动力学模拟轨迹文件分析 - R you ready?</a></li>
<li><a href="https://blog.chembiosim.com/cross-correlation-in-bio3d/">使用 Bio3D 进行互相关分析</a></li>
</ol>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2022-08-06/draws-chemicals-in-blender-using-common-input-chemical-formats/">化学分子的 3D 渲染</a></span>
  <span class="nav-next"><a href="/cn/2022-08-13/md-with-gromacs-and-openmm-for-small-molecules/">基于 Gromacs 和 OpenMM 的小分子分子动力学模拟</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/cn\/2022-08-06\/draws-chemicals-in-blender-using-common-input-chemical-formats\/';
    
  } else if (e.which == 39) {  
    
    url = '\/cn\/2022-08-13\/md-with-gromacs-and-openmm-for-small-molecules\/';
    
  }
  if (url) window.location = url;
});
</script>






<script async src="/js/fix-toc.js"></script>


<script async src="/js/center-img.js"></script>


<script async src="/js/right-quote.js"></script>


<script async src="/js/fix-footnote.js"></script>


<script async src="/js/math-code.js"></script>


<script async src="/js/external-link.js"></script>


<script async src="/js/alt-title.js"></script>


<script async src="/js/header-link.js"></script>




<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1988641-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-1988641-2');
</script>

  
  
  <hr>
  <div class="copyright">© <a href="/">XiaO</a> 2006 - 2022</div>
  
  </footer>
  </article>
  
  </body>
</html>

