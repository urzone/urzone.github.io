<!DOCTYPE html>
<html lang="cmn-Hans-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>ESP_DNN - XiaO | 缄默之语</title>
    <meta property="og:title" content="ESP_DNN - XiaO | 缄默之语">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="化合物表面静电势计算是一个很耗时耗力的过程，即使是基于更加便于处理的密度泛函理论 （DFT），即用电子密度取代波函数做为研究的基本量。而
[&amp;hellip;] PDB2PQR 是一个用于预测分子表面静电势的深度神经网络模型，该模型在十万个使用 DFT 计算而来的分子静电势表面上进行训练,其预测可接近 DFT 的计算结果。奈何该模型只能运行在 Linux 系统下，故而绕道谷歌 Colab。 &amp;hellip;">
      <meta property="og:description" content="化合物表面静电势计算是一个很耗时耗力的过程，即使是基于更加便于处理的密度泛函理论 （DFT），即用电子密度取代波函数做为研究的基本量。而
[&amp;hellip;] PDB2PQR 是一个用于预测分子表面静电势的深度神经网络模型，该模型在十万个使用 DFT 计算而来的分子静电势表面上进行训练,其预测可接近 DFT 的计算结果。奈何该模型只能运行在 Linux 系统下，故而绕道谷歌 Colab。 &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="https://urz.one/images/logo.png">
    
    

    

    
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    



<link rel="stylesheet" href="/css/custom.css" />


<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
<link rel="manifest" href="/images/icons/manifest.json">
<link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#cc342c">
<link rel="shortcut icon" href="/images/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="XiaO">
<meta name="application-name" content="XiaO">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-TileImage" content="/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="3C4lz-WqreDsFFohPRed1rO14aKeEDmTbw2lfIHN6og" />
  </head>

  
  <body class="cn">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.svg" alt="XiaO" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/cn/note/">缄语</a></li>
  
  <li><a href="/en/">En</a></li>
  
  

<li class="menu-extra"></li>


<li><a href="/cn/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>ESP_DNN</h1>


<h3>XiaO / 
2022-08-03</h3>

<hr>


      </header>



<h2 id="静电势esp">静电势（ESP）</h2>
<p>化合物表面静电势计算是一个很耗时耗力的过程，即使是基于更加便于处理的密度泛函理论 （DFT），即用电子密度取代波函数做为研究的基本量。而</p>
<h2 id="静电势预测-esp-dnn">静电势预测 (ESP-DNN)</h2>
<p><a href="https://magattaca.hatenablog.com/entry/2022/06/11/000051">PDB2PQR</a> 是一个用于预测分子表面静电势的深度神经网络模型，该模型在十万个使用 DFT 计算而来的分子静电势表面上进行训练,其预测可接近 DFT 的计算结果。奈何该模型只能运行在 Linux 系统下，故而绕道<a href="https://research.google.com/colaboratory/">谷歌 Colab</a>。</p>
<h3 id="模型安装">模型安装</h3>
<pre tabindex="0"><code># 在 Linux 上安装 Miniconda 
!wget -c https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
!chmod +x Miniconda3-latest-Linux-x86_64.sh
!bash ./Miniconda3-latest-Linux-x86_64.sh -b -f -p /usr/local

# 从 GitHub 获取 ESP-DNN 代码
!git clone https://github.com/urzone/ESP_DNN.git

# 移动工作目录到 ESP_DNN
%cd ESP_DNN

# 从工作目录中的配置文件 environment.yml 创建 ESP_DNN 运行所需的虚拟环境
!conda env create -f environment.yml
</code></pre><h3 id="分子准备">分子准备</h3>
<ul>
<li>pdb 格式分子（该模型只接受 pdb 的文件格式，故所有分子或者蛋白文件须为 pdb 格式）：
<ul>
<li>mol2SMILES；</li>
<li><a href="https://www.novoprolabs.com/tools/smiles2pdb">SMILES2PDB</a>，SMILES 分子格式转换为 3D PDB 格式；</li>
</ul>
</li>
<li>将准备好的 PDB 格式的分子文件上传至谷歌网盘的某个文价夹中；</li>
<li>在谷歌 Colab 中挂载谷歌网盘，一顿授权操作后，即可在谷歌 Colab 中读写网盘中的文件。</li>
</ul>
<h3 id="静电势预测">静电势预测</h3>
<pre tabindex="0"><code>%%bash

# 激活 esp-dnn-env 虚拟环境
source activate esp-dnn-env

# 对包含化合物分子的文件夹运行模型，譬如我将所需预测的分子文件放在 `MyDrive/DSDS/molecules/`文件夹中；
# 预测结果将直接保存在相同的文件夹中，可在网盘中直接下载；
python -m esp_dnn.predict -m ligand -i /content/drive/MyDrive/DSDS/molecules
</code></pre><h3 id="静电势可视化">静电势可视化</h3>
<ul>
<li>
<p>利用 <a href="http://nglviewer.org/ngl/">NGL viewer</a> 进行可视化：</p>
<ul>
<li>Open the PQR file using the File menu</li>
<li>Add a surface representation using the three line menu icon on the side bar on the right</li>
<li>On the surface menu, set:
<ul>
<li>surfaceType = av</li>
<li>radiusType = explicit</li>
<li>colorScheme = electrostatic</li>
<li>opacity = 0.5</li>
<li>colorScale = rwb</li>
</ul>
</li>
</ul>
</li>
<li>
<p>利用 <a href="https://jupyter.org/">Jupyter Notebook</a> 和 <a href="https://github.com/arose/nglview">nglview</a> 插件进行可视化。关于 Jupyter Notebook 的快速使用，可参考<a href="https://zhuanlan.zhihu.com/p/33105153">此处</a>。</p>
</li>
</ul>
<p>Jupyter 安装：</p>
<pre tabindex="0"><code># 为 Jupyter Notebook 创建虚拟环境
conda creat --name Jupyter 

# 激活该虚拟环境 
conda activate Jupter 

# 安装 jupyter notebook
conda install jupyter notebook

# 安装 python==3.8.8
conda install python==3.8.8 

## 安装 pytraj，用于读取多个 pdb 文件到一个轨迹中
# https://amber-md.github.io/pytraj/latest/installation.html
# https://github.com/nglviewer/nglview/issues/918
conda install -c ambermd pytraj

# 查看帮助文档
jupyter notebook --help

# 生成配置文件 `~/.jupyter/jupyter_notebook_config.py`
jupyter notebook --generate-config 

## 进入上述配置文件，修改 jupyter notebook 文件的存放位置
# The directory to use for notebooks and kernels.
# Default: &#39;&#39;
c.NotebookApp.notebook_dir = &#39;/Users/urzone/JupyterFiles&#39;

# 安装插件 jupyter_contrib_nbextensions，可直观地展示 Jupyter Notebook 的插件页面
conda install -c conda-forge jupyter_contrib_nbextensions

# 安装插件 nb_conda，该插件是 Jupyter Notebook 与 Conda 关联之后对 Conda 环境和包进行直接操作和管理的页面工具
conda install nb_conda

# 安装插件 nglview
conda install -c conda-forge nglview 
jupyter-nbextension enable nglview --py --sys-prefix

# 运行 Jupyter Notebook
jupyter notebook

# 运行 Jupyter Notebook，但不在浏览器打开
jupyter notebook --no-browser

# 指定 Jupyter Notebook 的端口
jupyter notebook --port &lt;port_number&gt;
</code></pre><p>在一个 Jupyter Notebook 文件中，添加如下代码（修改 pqrPath 文件的路径）：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 导入 nglview 包，并重命名</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> nglview <span style="color:#66d9ef">as</span> nv
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 导入分子文件地址</span>
</span></span><span style="display:flex;"><span>pqrPath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Users/urzone/Downloads/molecules/1.pdb.pqr&#34;</span>
</span></span><span style="display:flex;"><span>pdbPath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Users/urzone/Downloads/molecules/1.pdb&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加分子文件的呈现形式</span>
</span></span><span style="display:flex;"><span>pqrrepr <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;surface&#34;</span>, <span style="color:#e6db74">&#34;params&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;surfaceType&#34;</span>: <span style="color:#e6db74">&#34;av&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;radiusType&#34;</span>: <span style="color:#e6db74">&#34;explicit&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;colorScheme&#34;</span>: <span style="color:#e6db74">&#34;electrostatic&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;scaleFactor&#34;</span>: <span style="color:#ae81ff">4.0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;smooth&#34;</span>: <span style="color:#ae81ff">10.0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;opacity&#34;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;colorDomain&#34;</span>: [<span style="color:#f92672">-</span><span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">50</span>],   <span style="color:#75715e"># potential range in kcal/mol</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;colorScale&#34;</span>: <span style="color:#e6db74">&#39;rwb&#39;</span>     <span style="color:#75715e"># Try &#39;rainbow&#39;,&#34;rwb&#34; or any other scheme from ngl</span>
</span></span><span style="display:flex;"><span>    }}
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>pbdrepr <span style="color:#f92672">=</span> [ <span style="color:#75715e"># https://nglviewer.org/ngl/api/typedef/index.html#static-typedef-BallAndStickRepresentationParameters</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;ball+stick&#34;</span>, <span style="color:#e6db74">&#34;params&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;sphereDetail&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#75715e"># sphere quality (icosahedron subdivisions)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;radialSegments&#34;</span>: <span style="color:#ae81ff">100</span>, <span style="color:#75715e"># cylinder quality (number of segments)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;multipleBond&#34;</span>: <span style="color:#e6db74">&#34;symmetric&#34;</span>, <span style="color:#75715e"># symmetric offset</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;aspectRatio&#34;</span>: <span style="color:#ae81ff">2.4</span>,  <span style="color:#75715e"># size difference between atom and bond radii</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;bondScale&#34;</span>: <span style="color:#ae81ff">0.6</span>,  <span style="color:#75715e"># scale/radius for multiple bond rendering</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;bondSpacing&#34;</span>: <span style="color:#ae81ff">1.5</span> <span style="color:#75715e"># spacing for multiple bond rendering</span>
</span></span><span style="display:flex;"><span>    }}
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 显示第一分子</span>
</span></span><span style="display:flex;"><span>view <span style="color:#f92672">=</span> nv<span style="color:#f92672">.</span>show_file(pqrPath)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加第一分子的呈现形式</span>
</span></span><span style="display:flex;"><span>view<span style="color:#f92672">.</span>representations <span style="color:#f92672">=</span> pqrrepr
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加第二分子</span>
</span></span><span style="display:flex;"><span>view<span style="color:#f92672">.</span>add_component(pdbPath)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置第二分子的呈现形式</span>
</span></span><span style="display:flex;"><span>view<span style="color:#f92672">.</span>set_representations(pbdrepr, component<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>view
</span></span></code></pre></div><p>调整好分子的位置，<a href="https://nglviewer.org/nglview/latest/api.html">将当前位置的保存为图片</a>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># render and download scene at current frame</span>
</span></span><span style="display:flex;"><span>view<span style="color:#f92672">.</span>download_image(filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;screenshot.png&#39;</span>, <span style="color:#75715e"># str, default &#39;screenshot.png&#39;</span>
</span></span><span style="display:flex;"><span>                    factor<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>, <span style="color:#75715e"># int, default 4, quality of the image, higher is better</span>
</span></span><span style="display:flex;"><span>                    antialias<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,  <span style="color:#75715e"># bool, default True</span>
</span></span><span style="display:flex;"><span>                    trim<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, <span style="color:#75715e"># bool, default False</span>
</span></span><span style="display:flex;"><span>                    transparent<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) <span style="color:#75715e"># bool, default False</span>
</span></span></code></pre></div>

  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2022-07-20/r-drafting-and-layout/">R 绘图排版</a></span>
  <span class="nav-next"><a href="/cn/2022-08-06/draws-chemicals-in-blender-using-common-input-chemical-formats/">化学分子的 3D 渲染</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/cn\/2022-07-20\/r-drafting-and-layout\/';
    
  } else if (e.which == 39) {  
    
    url = '\/cn\/2022-08-06\/draws-chemicals-in-blender-using-common-input-chemical-formats\/';
    
  }
  if (url) window.location = url;
});
</script>






<script async src="/js/fix-toc.js"></script>


<script async src="/js/center-img.js"></script>


<script async src="/js/right-quote.js"></script>


<script async src="/js/fix-footnote.js"></script>


<script async src="/js/math-code.js"></script>


<script async src="/js/external-link.js"></script>


<script async src="/js/alt-title.js"></script>


<script async src="/js/header-link.js"></script>





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1988641-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-1988641-2');
</script>

  
  
  <hr>
  <div class="copyright">© <a href="/">XiaO</a> 2006 - 2022</div>
  
  </footer>
  </article>
  
  </body>
</html>

