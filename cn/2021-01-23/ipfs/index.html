<!DOCTYPE html>
<html lang="cmn-Hans-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>IPFS 构建去中心化网站 - XiaO | 缄默之语</title>
    <meta property="og:title" content="IPFS 构建去中心化网站 - XiaO | 缄默之语">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="IPFS，又称“星际文件系统”。简单点说，它是一个点对点的分布式文件系统（和比特币技术一样），通过底层协议，可以让存储在 IPFS 系统上的文件，在全世界任何一个地方快速获取，且不受防火墙的影响（无需网络代理）。
现在所使用的互联网协议被称作——超文本协议 HTTP，是一种超中心化特性。当从互联网上下载文件或者是浏览网页，一次只能从一个数据中心获取你所需要的资料。如果这个数据中心出现故障，或者被限 &amp;hellip;">
      <meta property="og:description" content="IPFS，又称“星际文件系统”。简单点说，它是一个点对点的分布式文件系统（和比特币技术一样），通过底层协议，可以让存储在 IPFS 系统上的文件，在全世界任何一个地方快速获取，且不受防火墙的影响（无需网络代理）。
现在所使用的互联网协议被称作——超文本协议 HTTP，是一种超中心化特性。当从互联网上下载文件或者是浏览网页，一次只能从一个数据中心获取你所需要的资料。如果这个数据中心出现故障，或者被限 &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="https://urz.one/images/logo.png">
    
    

    

    
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    



<link rel="stylesheet" href="/css/custom.css" />


<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/icons/favicon-16x16.png">
<link rel="manifest" href="/images/icons/manifest.json">
<link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#cc342c">
<link rel="shortcut icon" href="/images/icons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="XiaO">
<meta name="application-name" content="XiaO">
<meta name="msapplication-TileColor" content="#603cba">
<meta name="msapplication-TileImage" content="/images/icons/mstile-144x144.png">
<meta name="msapplication-config" content="/images/icons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<meta name="google-site-verification" content="3C4lz-WqreDsFFohPRed1rO14aKeEDmTbw2lfIHN6og" />
  </head>

  
  <body class="cn">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.svg" alt="XiaO" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/cn/note/">缄语</a></li>
  
  <li><a href="/cn/vitae/">简历</a></li>
  
  <li><a href="/en/">English</a></li>
  
  

<li class="menu-extra"></li>


<li><a href="/cn/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>IPFS 构建去中心化网站</h1>


<h3>XiaO / 
2021-01-23</h3>

<hr>


      </header>



<h2 id="ipfs-简介">IPFS 简介</h2>
<p>IPFS，又称“星际文件系统”。简单点说，它是一个点对点的分布式文件系统（和比特币技术一样），通过底层协议，可以让存储在 IPFS 系统上的文件，在全世界任何一个地方快速获取，且不受防火墙的影响（无需网络代理）。</p>
<p>现在所使用的互联网协议被称作——超文本协议 HTTP，是一种超中心化特性。当从互联网上下载文件或者是浏览网页，一次只能从一个数据中心获取你所需要的资料。如果这个数据中心出现故障，或者被限制或是攻击，就会出现文件丢失或者网页无法打开的问题。</p>
<h3 id="http-的痛点">HTTP 的痛点</h3>
<p>HTTP 协议已经用了 20 年的历史，从 HTTP 1.0 到现在的 HTTP5，网页的展示越来越美观丰富，但它背后的 Browser/Server 模式是从来没有改变过。</p>
<ul>
<li>HTTP效率低下，服务器成本昂贵</li>
<li>历史文件被删除</li>
<li>网络应用太依赖骨干网</li>
<li>中心化的网络限制了机会</li>
</ul>
<h3 id="ipfs-特质">IPFS 特质</h3>
<ul>
<li>互联网信息永久存储</li>
</ul>
<p>IPFS 像一个分布式存储网络，任何存储在系统里的资源，包括文字、图片、声音、视频，以及网站代码，通过 IPFS 进行哈希运算后，都会生成唯一的地址。今后，你只要通过这个地址就可以打开它们。并且这个地址是可以被分享的。</p>
<p>而由于加密算法的保护，该地址具备了不可篡改和删除的特性（在某种意义上，如果破解密码还是有可能被篡改或删除，但概率极低）。所以，一旦数据存储在 IPFS 网络中，它就会是永久性的。即便我们把该站点撤销，只要存储该站点信息的网络依然存在，该网页就可以被正常访问。存储站点的分布式网络越多，它的可靠性也就越强。</p>
<p>IPFS 存储的一般是公共信息，普通大众都可以获得的。有一种说法认为，如果 IPFS 完全取代 HTTP，那么此后，人类历史将会被永久保存，且不会被篡改。这也就意味着，人类所做的每一件事情都会被记录，不管是正确的、抑或是错误的。</p>
<ul>
<li>解决过度冗余问题，实现共享经济</li>
</ul>
<p>IPFS 会把存储文件，做一次哈希计算，只字不差的两个文件哈希值相同。所以，用户只需要使用相同的哈希值，就可以访问那个文件，这个哈希值就是文件的地址。只要获取这个地址，就可以共享资源了。</p>
<p>基于上面的永久存储特性，再也不用担心某个电影找不到了，也不用备份，因为全球电脑上只要有那么几个人存储着，你就能拿到它，并且不依赖于中心网络。</p>
<ul>
<li>基于内容（而非域名）寻址</li>
</ul>
<p>IPFS 的网络上运行着一条区块链，即用来存储互联网文件的哈希值表，每次有网络访问，即要在链上查询该内容（文件）的地址。</p>
<p>文件（内容）具有存在的唯一性，一个文件加入了IPFS的网络，将基于计算对内容赋予一个唯一加密的哈希值。这将改变我们使用域名访问网络的习惯。</p>
<p>提供文件的历史版本控制器（类似Git），并且让多节点使用保存不同版本的文件。</p>
<ul>
<li>节点存储激励，代币分成</li>
</ul>
<p>通过使用代币（FileCoin）的激励作用，让各节点有动力去存储数据。 Filecoin  是一个由加密货币驱动的存储网络。<strong>矿工通过为网络提供开放的硬盘空间获得 Filecoin，而用户则用 Filecoin 来支付在去中心化网络中储存加密文件的费用</strong>。</p>
<h3 id="ipfs-工作原理">IPFS 工作原理</h3>
<ul>
<li>每个文件及其中的所有块都被赋予一个称为加密散列的唯一指纹。
IPFS 通过网络删除重复具有相同哈希值的文件，通过计算是可以判断哪些文件是冗余重复的。并跟踪每个文件的版本历史记录；</li>
<li>每个网络节点只存储它感兴趣的内容，以及一些索引信息，有助于弄清楚谁在存储什么；</li>
<li>查找文件时，你通过文件的哈希值就可以在网络查找到储存改文件的节点，找到想要的文件；</li>
<li>使用称为 IPNS（去中心化命名系统），每个文件都可以被协作命名为易读的名字。通过搜索，就能很容易地找到想要查看的文件。</li>
<li>从 IPFS 的介绍可以看出， IPFS 设想的是让所有的网络终端节点不仅仅只充当 Browser 或 Client 的角色，其实人人都可以作为这个网络的运营者，人人都可以是服务器。</li>
</ul>
<h2 id="ipfs-配置">IPFS 配置</h2>
<h3 id="1-下载安装1">1. <a href="https://docs.ipfs.io/install/command-line/#official-distributions">下载安装</a></h3>
<p><a href="https://dist.ipfs.io/go-ipfs/v0.7.0/go-ipfs_v0.7.0_darwin-amd64.tar.gz">下载</a> Mac 版 IPFS 安装文件 <code>go-ipfs_v0.7.0_darwin-amd64.tar.gz</code>，解压缩该文件，得到 <code>go-ipfs</code> 文件夹，包含如下文件：</p>
<pre><code>├── LICENSE
├── LICENSE-APACHE
├── LICENSE-MIT
├── README.md
├── install.sh
└── ipfs
</code></pre><p>安装 IPFS</p>
<pre><code>cd go-ipfs
install.sh
&gt; Moved ./ipfs to /usr/local/bin

ipfs --version                                        
&gt; ipfs version 0.7.0 # 出现版本信息，表示安装成功
</code></pre><p><a href="https://docs.ipfs.io/recent-releases/go-ipfs-0-5/update-procedure/#use-ipfs-update">升级</a> IPFS，下载 <a href="https://dist.ipfs.io/#ipfs-update">ipfs-update</a> 工具，解压缩</p>
<pre><code>cd ipfs-update
install.sh

&gt; Moved ./ipfs-update to /usr/local/bin

ipfs-update --version # 出现版本信息，表示安装成功

</code></pre><h3 id="2-ipfs-本地部署">2. IPFS 本地部署</h3>
<ul>
<li>创建节点
<ul>
<li>或生成新节点（文件仓库）</li>
<li>或<a href="https://github.com/ipfs/fs-repo-migrations/blob/master/run.md">迁移</a>现有节点，需要 <a href="https://dist.ipfs.io/#fs-repo-migrations">fs-repo-migrations</a> 工具。解压下载的 fs-repo-migrations 工具，在终端中运行 <code>fs-repo-migrations</code>即可完成版本迁移</li>
</ul>
</li>
</ul>
<pre><code>ipfs init # 创建新节点，所生成的新文件夹`.ipfs` 所含文件如下
.
├── blocks
├── config
├── datastore
├── datastore_spec
├── keystore
└── version

fs-repo-migrations -revert-ok -to 10 # 将现有节点迁移到指定版本，比如 10
</code></pre><ul>
<li>节点配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{
  <span style="color:#f92672">&#34;API&#34;: </span>{
    <span style="color:#f92672">&#34;HTTPHeaders&#34;: </span>{
      <span style="color:#f92672">&#34;Server&#34;: </span>[
        <span style="color:#e6db74">&#34;go-ipfs/0.4.14&#34;</span>
      ]
    }
  },
  <span style="color:#f92672">&#34;Addresses&#34;: </span>{
    <span style="color:#f92672">&#34;API&#34;: </span><span style="color:#e6db74">&#34;/ip4/127.0.0.1/tcp/5001&#34;</span>,
    <span style="color:#f92672">&#34;Announce&#34;: </span>[],
    <span style="color:#f92672">&#34;Gateway&#34;: </span><span style="color:#e6db74">&#34;/ip4/127.0.0.1/tcp/8080&#34;</span>,
    <span style="color:#f92672">&#34;NoAnnounce&#34;: </span>[],
    <span style="color:#f92672">&#34;Swarm&#34;: </span>[
      <span style="color:#e6db74">&#34;/ip4/0.0.0.0/tcp/4001&#34;</span>,
      <span style="color:#e6db74">&#34;/ip6/::/tcp/4001&#34;</span>,
      <span style="color:#e6db74">&#34;/ip4/0.0.0.0/udp/4001/quic&#34;</span>,
      <span style="color:#e6db74">&#34;/ip6/::/udp/4001/quic&#34;</span>
    ]
  },
  <span style="color:#f92672">&#34;Bootstrap&#34;: </span>[
    <span style="color:#e6db74">&#34;/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN&#34;</span>,
    <span style="color:#e6db74">&#34;/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa&#34;</span>,
    <span style="color:#e6db74">&#34;/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb&#34;</span>,
    <span style="color:#e6db74">&#34;/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/104.236.179.241/tcp/4001/p2p/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/128.199.219.111/tcp/4001/p2p/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/104.236.76.40/tcp/4001/p2p/QmSoLV4Bbm51jM9C4gDYZQ9Cy3U6aXMJDAbzgu2fzaDs64&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/178.62.158.247/tcp/4001/p2p/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd&#34;</span>,
    <span style="color:#e6db74">&#34;/ip6/2604:a880:1:20::203:d001/tcp/4001/p2p/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM&#34;</span>,
    <span style="color:#e6db74">&#34;/ip6/2400:6180:0:d0::151:6001/tcp/4001/p2p/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu&#34;</span>,
    <span style="color:#e6db74">&#34;/ip6/2604:a880:800:10::4a:5001/tcp/4001/p2p/QmSoLV4Bbm51jM9C4gDYZQ9Cy3U6aXMJDAbzgu2fzaDs64&#34;</span>,
    <span style="color:#e6db74">&#34;/ip6/2a03:b0c0:0:1010::23:1001/tcp/4001/p2p/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd&#34;</span>,
    <span style="color:#e6db74">&#34;/ip4/104.131.131.82/udp/4001/quic/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ&#34;</span>
  ],
  <span style="color:#f92672">&#34;Datastore&#34;: </span>{
    <span style="color:#f92672">&#34;BloomFilterSize&#34;: </span><span style="color:#ae81ff">0</span>,
    <span style="color:#f92672">&#34;GCPeriod&#34;: </span><span style="color:#e6db74">&#34;1h&#34;</span>,
    <span style="color:#f92672">&#34;HashOnRead&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;Spec&#34;: </span>{
      <span style="color:#f92672">&#34;mounts&#34;: </span>[
        {
          <span style="color:#f92672">&#34;child&#34;: </span>{
            <span style="color:#f92672">&#34;path&#34;: </span><span style="color:#e6db74">&#34;blocks&#34;</span>,
            <span style="color:#f92672">&#34;shardFunc&#34;: </span><span style="color:#e6db74">&#34;/repo/flatfs/shard/v1/next-to-last/2&#34;</span>,
            <span style="color:#f92672">&#34;sync&#34;: </span><span style="color:#66d9ef">true</span>,
            <span style="color:#f92672">&#34;type&#34;: </span><span style="color:#e6db74">&#34;flatfs&#34;</span>
          },
          <span style="color:#f92672">&#34;mountpoint&#34;: </span><span style="color:#e6db74">&#34;/blocks&#34;</span>,
          <span style="color:#f92672">&#34;prefix&#34;: </span><span style="color:#e6db74">&#34;flatfs.datastore&#34;</span>,
          <span style="color:#f92672">&#34;type&#34;: </span><span style="color:#e6db74">&#34;measure&#34;</span>
        },
        {
          <span style="color:#f92672">&#34;child&#34;: </span>{
            <span style="color:#f92672">&#34;compression&#34;: </span><span style="color:#e6db74">&#34;none&#34;</span>,
            <span style="color:#f92672">&#34;path&#34;: </span><span style="color:#e6db74">&#34;datastore&#34;</span>,
            <span style="color:#f92672">&#34;type&#34;: </span><span style="color:#e6db74">&#34;levelds&#34;</span>
          },
          <span style="color:#f92672">&#34;mountpoint&#34;: </span><span style="color:#e6db74">&#34;/&#34;</span>,
          <span style="color:#f92672">&#34;prefix&#34;: </span><span style="color:#e6db74">&#34;leveldb.datastore&#34;</span>,
          <span style="color:#f92672">&#34;type&#34;: </span><span style="color:#e6db74">&#34;measure&#34;</span>
        }
      ],
      <span style="color:#f92672">&#34;type&#34;: </span><span style="color:#e6db74">&#34;mount&#34;</span>
    },
    <span style="color:#f92672">&#34;StorageGCWatermark&#34;: </span><span style="color:#ae81ff">90</span>,
    <span style="color:#f92672">&#34;StorageMax&#34;: </span><span style="color:#e6db74">&#34;2GB&#34;</span>
  },
  <span style="color:#f92672">&#34;Discovery&#34;: </span>{
    <span style="color:#f92672">&#34;MDNS&#34;: </span>{
      <span style="color:#f92672">&#34;Enabled&#34;: </span><span style="color:#66d9ef">true</span>,
      <span style="color:#f92672">&#34;Interval&#34;: </span><span style="color:#ae81ff">10</span>
    }
  },
  <span style="color:#f92672">&#34;Experimental&#34;: </span>{
    <span style="color:#f92672">&#34;FilestoreEnabled&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;Libp2pStreamMounting&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;ShardingEnabled&#34;: </span><span style="color:#66d9ef">false</span>
  },
  <span style="color:#f92672">&#34;Gateway&#34;: </span>{
    <span style="color:#f92672">&#34;HTTPHeaders&#34;: </span>{
      <span style="color:#f92672">&#34;Access-Control-Allow-Headers&#34;: </span>[
        <span style="color:#e6db74">&#34;X-Requested-With&#34;</span>,
        <span style="color:#e6db74">&#34;Range&#34;</span>
      ],
      <span style="color:#f92672">&#34;Access-Control-Allow-Methods&#34;: </span>[
        <span style="color:#e6db74">&#34;GET&#34;</span>
      ],
      <span style="color:#f92672">&#34;Access-Control-Allow-Origin&#34;: </span>[
        <span style="color:#e6db74">&#34;*&#34;</span>
      ]
    },
    <span style="color:#f92672">&#34;PathPrefixes&#34;: </span>[],
    <span style="color:#f92672">&#34;RootRedirect&#34;: </span><span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;Writable&#34;: </span><span style="color:#66d9ef">false</span>
  },
  <span style="color:#f92672">&#34;Identity&#34;: </span>{
    <span style="color:#f92672">&#34;PeerID&#34;: </span><span style="color:#e6db74">&#34;QmXXXXXXXXXXXXXXX&#34;</span>,
    <span style="color:#f92672">&#34;PrivKey&#34;: </span><span style="color:#e6db74">&#34;XXXXXXXXXXXX&#34;</span>
  },
  <span style="color:#f92672">&#34;Ipns&#34;: </span>{
    <span style="color:#f92672">&#34;RecordLifetime&#34;: </span><span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;RepublishPeriod&#34;: </span><span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#f92672">&#34;ResolveCacheSize&#34;: </span><span style="color:#ae81ff">128</span>
  },
  <span style="color:#f92672">&#34;Mounts&#34;: </span>{
    <span style="color:#f92672">&#34;FuseAllowOther&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;IPFS&#34;: </span><span style="color:#e6db74">&#34;/ipfs&#34;</span>,
    <span style="color:#f92672">&#34;IPNS&#34;: </span><span style="color:#e6db74">&#34;/ipns&#34;</span>
  },
  <span style="color:#f92672">&#34;Reprovider&#34;: </span>{
    <span style="color:#f92672">&#34;Interval&#34;: </span><span style="color:#e6db74">&#34;12h&#34;</span>,
    <span style="color:#f92672">&#34;Strategy&#34;: </span><span style="color:#e6db74">&#34;all&#34;</span>
  },
  <span style="color:#f92672">&#34;Swarm&#34;: </span>{
    <span style="color:#f92672">&#34;AddrFilters&#34;: </span><span style="color:#66d9ef">null</span>,
    <span style="color:#f92672">&#34;ConnMgr&#34;: </span>{
      <span style="color:#f92672">&#34;GracePeriod&#34;: </span><span style="color:#e6db74">&#34;20s&#34;</span>,
      <span style="color:#f92672">&#34;HighWater&#34;: </span><span style="color:#ae81ff">900</span>,
      <span style="color:#f92672">&#34;LowWater&#34;: </span><span style="color:#ae81ff">600</span>,
      <span style="color:#f92672">&#34;Type&#34;: </span><span style="color:#e6db74">&#34;basic&#34;</span>
    },
    <span style="color:#f92672">&#34;DisableBandwidthMetrics&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;DisableNatPortMap&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;DisableRelay&#34;: </span><span style="color:#66d9ef">false</span>,
    <span style="color:#f92672">&#34;EnableRelayHop&#34;: </span><span style="color:#66d9ef">false</span>
  }
}

</code></pre></div><ul>
<li>节点 ID</li>
</ul>
<p>每个节点都会存在一个唯一标识。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">ipfs id</span> <span style="color:#75715e"># 查看节点 ID</span>

{
	<span style="color:#f92672">&#34;ID&#34;: </span><span style="color:#e6db74">&#34;QmXXXXXXXXXXXXXXX&#34;</span>,
	<span style="color:#f92672">&#34;PublicKey&#34;: </span><span style="color:#e6db74">&#34;XXXXXXXXXXXXXXX&#34;</span>,
	<span style="color:#f92672">&#34;Addresses&#34;: </span><span style="color:#66d9ef">null</span>,
	<span style="color:#f92672">&#34;AgentVersion&#34;: </span><span style="color:#e6db74">&#34;go-ipfs/0.7.0/&#34;</span>,
	<span style="color:#f92672">&#34;ProtocolVersion&#34;: </span><span style="color:#e6db74">&#34;ipfs/0.1.0&#34;</span>,
	<span style="color:#f92672">&#34;Protocols&#34;: </span><span style="color:#66d9ef">null</span>
}
</code></pre></div><ul>
<li>启动节点，启动后可通过 <code>http://127.0.0.1:5001/webui</code> 在浏览器中打开 IPFS。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-zsh" data-lang="zsh">ipfs daemon <span style="color:#75715e"># 启动节点</span>

Initializing daemon...
go-ipfs version: 0.7.0
Repo version: <span style="color:#ae81ff">10</span>
System version: amd64/darwin
Golang version: go1.14.4
Swarm listening on /ip4/127.0.0.1/tcp/4001
Swarm listening on /ip4/127.0.0.1/udp/4001/quic
Swarm listening on /ip4/192.168.0.102/tcp/4001
Swarm listening on /ip4/192.168.0.102/udp/4001/quic
Swarm listening on /ip6/::1/tcp/4001
Swarm listening on /ip6/::1/udp/4001/quic
Swarm listening on /p2p-circuit
Swarm announcing /ip4/127.0.0.1/tcp/4001
Swarm announcing /ip4/127.0.0.1/udp/4001/quic
Swarm announcing /ip4/192.168.0.102/tcp/4001
Swarm announcing /ip4/192.168.0.102/udp/4001/quic
Swarm announcing /ip6/::1/tcp/4001
Swarm announcing /ip6/::1/udp/4001/quic
API server listening on /ip4/127.0.0.1/tcp/5001
WebUI: http://127.0.0.1:5001/webui
Gateway <span style="color:#f92672">(</span>readonly<span style="color:#f92672">)</span> server listening on /ip4/127.0.0.1/tcp/8080
Daemon is ready
</code></pre></div><p>执行命令后，最后出现 <code>Daemon is ready</code>，就代表节点启动成功了，并已经作为节点加入了 IPFS 网络了。</p>
<p>检查本机的种子节点命令：<code>ipfs bootstrap</code> 检查本机加入的集群信息：<code>ipfs swarm peers</code>。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">GATEWAY</span>: <span style="color:#ae81ff">http://localhost:8080</span>
<span style="color:#f92672">API</span>: <span style="color:#ae81ff">http://127.0.0.1:5001</span>
</code></pre></div><ul>
<li>本地发布站点文件到 IPFS</li>
</ul>
<p><a href="https://flyingzumwalt.gitbooks.io/decentralized-web-primer/content/publishing-changes/lessons/create-webpage.html">注意</a>，使用带有 <code>-r</code> 参数的 <code>ipfs add</code> 命令，即 <code>ipfs add -r</code>，以便将文件夹下所有文件递归地添加到 IPFS。</p>
<pre><code>ipfs add -r Path/to/webpage/Folder

ipfs add -r ~/Downloads/me     
added QmdNsncGJ35Uy247gSW9JG2oqvUjNwfQNcLC9BzGKMtZP7 me/assets/css/me.css
added QmSGwLaWfAF8VURTUdjLrYJLuCfeSM4DNkouPH5622v6rP me/assets/sass/00-reset.scss
added QmPHZrugucjRVuRQVHVh47cBZ47mC3ch2ktJP7wFDUNPQv me/assets/sass/01-content.scss
added QmdmeTQHUXbjhhfKVYsYutRPwTve7xqaFQx1Jzp7KFUzKc me/assets/sass/me.scss
added QmVhTyfjPvPjVm9Qr2HzHhEcPHuUTdwyFoGSbrun26eqge me/images/background.jpg
added QmS9GrnuFH7316vxbygdTWjsQidTheWbLq9W8ESyGY715H me/images/favicon.png
added QmarPeQ5brfhdstyJFnY6PmK6TZFDkfbktwCwt4eHcaTkV me/images/logo.png
added QmcML7GAxYfbfQoHUFWpYDEBXfoagVkGE4enWiWCJymwBa me/images/social.jpg
added QmVEJXxaPnGqaXH6wEmLonKNzbBi6svU5b8CcokKLUQyPA me/index-static.html
added QmeSGXLwY9Nc3Zwtrv2JiCSS5hDhFfwDwZaJKekdwdqVn7 me/index-youtube.html
added QmNZWBqCrhNinmfq8yUxxPteyubAGmMfzL6CubKgeeeT59 me/index.html
added QmTWxfA4jaSujHPVhLu1VVY888kLgbxnzVjcXp369Ge3eS me/readme.md
added QmWadsLVLLCyrMxJ6owQQRGpunQHcjeVpF3Z4rbFanm8it me/readme.txt
added QmZQZSEA5Cgyn3iCW4qTtDAjt2f25RRqFyPDPyeBJPCcNF me/videos/background.mp4
added QmV29PcMMYZ5SVe1SWJWw8VdwDj6xmBKVJmF4pykviDz5t me/assets/css
added QmeES6u2o7LpCdkh72KreSQ8Cea16e6LdvSHhV1K5KoNBE me/assets/sass
added QmbshznhgJn5MMi1nLzSyAeKb9VUtD9HLP57LoPgXPQurd me/assets
added QmcvWkbm2nUFNSfaWyo1Rc4UQvndSgeHbJd6rrFs4QRrXM me/images
added QmaZ8B21dkpTVAMpdkcYQsaqfetsotKQxeb6ug7xmJ4CFP me/videos
added QmNWsJM4c2ESKmwhVvz3nh1h87jrtxfvTVXViUSzE7m9dV me
 1.34 MiB / 1.34 MiB [=====================================================] 100.00%
</code></pre><ul>
<li>托管站点文件到 <a href="https://pinata.cloud/">pinata.cloud</a></li>
</ul>
<p>我们需要一种服务，将内容放入其中之后，它可以保证内容一直在线， 供他人访问或复制。 这种服务并不需要承担所有访问流量， 但它需要承诺持续在线。 在 IPFS 世界中， 这种将文件“钉”在网络中的服务被称为&quot;pin”。</p>
<p>虽然也可以自己搭建 IPFS 节点来完成上述任务，但对于个人网站这种简单场景， 更好的选择是使用现成的&quot;pin&quot;服务。Pinata 就是这样一个服务。 使用简便， 而且1G以下的存储容量是完全免费的。</p>
<p>注册 Pinata 之后， 访问 (<a href="https://pinata.cloud/pinataupload">https://pinata.cloud/pinataupload</a>) 即可执行上传操作。 选择 “Upload Directory”后，可将包含网站的文件夹整体上传。上传成功以后将得到 CID (即此文件夹在 IPFS 中的内容 ID)，也可以在 (<a href="https://pinata.cloud/pinexplorer">https://pinata.cloud/pinexplorer</a>) 管理已上传的文件或文件夹。</p>
<ul>
<li>通过 IPFS 访问站点</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">https://ipfs.io/ipfs/your-webpage-hash</span> <span style="color:#75715e"># 使用 `IPFS hash` 访问站点；</span>
</code></pre></div><ul>
<li><a href="https://flyingzumwalt.gitbooks.io/decentralized-web-primer/content/publishing-changes/lessons/modify-republish.html">发布到 IPNS</a></li>
</ul>
<p>IPFS 中，网站的哈希值和网站的内容是一一对应的，网页中任何的改变都将导致其生成新的哈希值。所以，每次更新网站之后，网站的哈希值都会变，旧的链接不能访问到新的内容。</p>
<p>通过 IPNS，将网站的 IPFS 哈希值与 Peer ID 绑定，完后更新完网站，可通过 IPNS 使用 Peer ID 来访问站点，而每个用户的 Peer ID 可保持不变。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ipfs name publish your<span style="color:#f92672">-</span>webpage<span style="color:#f92672">-</span>hash <span style="color:#75715e"># 将网站的 IPFS 哈希值发布到 IPNS</span>

ipfs name publish QmNWsJM4c2ESKmwhVvz3nh1h87jrtxfvTVXViUSzE7m9dV <span style="color:#75715e"># 将上述网站发布到 IPNS</span>
Published to k2k4r8ot14v7ncfnxhvq4hx86thrxkn2sghvmjcrksas8fyqojwmnrq7<span style="color:#f92672">:</span> <span style="color:#f92672">/</span>ipfs<span style="color:#f92672">/</span>QmNWsJM4c2ESKmwhVvz3nh1h87jrtxfvTVXViUSzE7m9dV <span style="color:#75715e">#  将 IPFS 哈希值发布到 IPNS，生成了一个新的 IPNS 哈希值；</span>

ipfs name resolve your<span style="color:#f92672">-</span>peer<span style="color:#f92672">-</span>id <span style="color:#75715e"># 验证 Peer ID 和网站的哈希已经绑定</span>
<span style="color:#f92672">/</span>ipfs<span style="color:#f92672">/</span>your<span style="color:#f92672">-</span>webpage<span style="color:#f92672">-</span>hash

ipfs name resolve QmctjMf6xLZGiiXSoK9JAmvVdXwgpLBGLcShPE9fGpDbxr
<span style="color:#f92672">/</span>ipfs<span style="color:#f92672">/</span>QmNWsJM4c2ESKmwhVvz3nh1h87jrtxfvTVXViUSzE7m9dV
</code></pre></div><ul>
<li>通过 IPNS 使用 Peer ID 来访问站点</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">https<span style="color:#f92672">://</span>ipfs.io<span style="color:#f92672">/</span>ipns<span style="color:#f92672">/</span>your<span style="color:#f92672">-</span>peer<span style="color:#f92672">-</span>id
https<span style="color:#f92672">://</span>ipfs.io<span style="color:#f92672">/</span>ipns<span style="color:#f92672">/</span>QmctjMf6xLZGiiXSoK9JAmvVdXwgpLBGLcShPE9fGpDbxr
</code></pre></div><ul>
<li><a href="https://www.chedan.io/posts/host-website-with-ipfs/">绑定域名</a>（避免使用复杂的哈希值访问网站）</li>
</ul>
<p>我们已经有一个域名<code>sub.your.domain</code>，可创建一个 DNS TXT 记录（DNSLink），这条记录的键（name 或者  key）为 <code>_dnslink.sub.your.domain</code>，值（data）为 <code>dnslink=/ipns/$SITE_CID</code>，其中 $SITE_CID 为站点的 Peer ID，将 Peer ID 与域名绑定。</p>
<pre><code>TXT _dnslink.www.urz.one dnslink=/ipns/QmctjMf6xLZGiiXSoK9JAmvVdXwgpLBGLcShPE9fGpDbxr
</code></pre><p>在域名解析里面建立一条 CNAME 记录，将 <code>sub.your.domain</code> 解析指向 <code>cloudflare-ipfs.com</code>.</p>
<pre><code>CNAME www.urz.one cloudflare-ipfs.com
</code></pre><ul>
<li>HTTPS 保护</li>
</ul>
<p>访问 <a href="https://cloudflare-ipfs.com/">Cloudflare IPFS Gateway</a>，在页面最底部文本框中输入想要保护的域名（在本例中即 <a href="http://www.urz.one">www.urz.one</a>）， 等待几分钟， 就会提示 “Certificate is live”。</p>
<p>至此，我们就可以通过<code>sub.your.domain</code> 直接访问 ipfs 网站了。</p>
<ul>
<li>网站更新</li>
</ul>
<p>网站本地更新后，将内容托管到 <a href="https://pinata.cloud/">pinata.cloud</a>，将 <a href="https://pinata.cloud/">pinata.cloud</a> 生成的内容 CID，发布到 IPNS <code>ipfs name publish site-hash</code> 即可。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">nslookup cloudflare<span style="color:#f92672">-</span>ipfs.com. <span style="color:#75715e"># 查询服务节点的 IP</span>
Server<span style="color:#f92672">:</span>		<span style="color:#ae81ff">8.8.8.8</span>
Address<span style="color:#f92672">:</span>	<span style="color:#ae81ff">8.8.8.8</span><span style="color:#75715e">#53</span>
Non<span style="color:#f92672">-</span>authoritative answer<span style="color:#f92672">:</span>
Name<span style="color:#f92672">:</span>	cloudflare<span style="color:#f92672">-</span>ipfs.com
Address<span style="color:#f92672">:</span> <span style="color:#ae81ff">104.244.46.5</span>

dig <span style="color:#f92672">+</span>noall <span style="color:#f92672">+</span>answer TXT www.urz.one         
www.urz.one.		<span style="color:#ae81ff">21599</span>	IN	CNAME	cloudflare<span style="color:#f92672">-</span>ipfs.com.
</code></pre></div>

  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2021-01-22/property-trade-in-chengdu/">成都存量房交易流程</a></span>
  <span class="nav-next"><a href="/cn/2021-01-27/macos-downgrading/">macOS 系统降级</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/cn\/2021-01-22\/property-trade-in-chengdu\/';
    
  } else if (e.which == 39) {  
    
    url = '\/cn\/2021-01-27\/macos-downgrading\/';
    
  }
  if (url) window.location = url;
});
</script>






<script async src="/js/fix-toc.js"></script>


<script async src="/js/center-img.js"></script>


<script async src="/js/right-quote.js"></script>


<script async src="/js/fix-footnote.js"></script>


<script async src="/js/math-code.js"></script>


<script async src="/js/external-link.js"></script>


<script async src="/js/alt-title.js"></script>


<script async src="/js/header-link.js"></script>




<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1988641-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-1988641-2');
</script>

  
  
  <hr>
  <div class="copyright">© <a href="/">XiaO</a> 2006 - 2021</div>
  
  </footer>
  </article>
  
  </body>
</html>

